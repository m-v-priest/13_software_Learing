
= excel中 用 vba输出数学计算题, 并可按 f9 刷新
:toc: left
:toclevels: 3
:sectnums:
:stylesheet: myAdocCss.css


'''



== 对 deepseek的 指令要求


在excel中实现以下功能:

1. 我要创建120道加法或减法的题目, 模板是 a+b=c, 或 c-a=b, c可以等于100但不超过100. 比如:  24+()=87,  68-()=56, ()+16=97, ()-23 = 57 这样的. 括号中就是留给用户之后要算出的数字. 题目中的小括号, 可以在等号右边, 比如可以出现  65+14=()
2. 这120道题, 不能有重复, 即不要出现相同的计算题.
3. 生成的每道计算题, 不要出现10以下的数字, 小括号中也不要出现10以下的数字. 比如, 不要出现 25-5=(), 或 ()-1=54, 66+()=68 这样的
4. 这120道题, 分散在excel表格的20行,6列 的单元格中. 即这120个单元格, 每个单元格中放一道题.
5. 每道计算题中的小括号中, 要打上6个空格, 给用户足够的空间来填入计算的数字. 因为我会打印出纸张后, 用铅笔来填入数字.
6. 以后在excel中每次按f9键, 都能重新输出120道全新的题目. 注意: 每一次的120道题目中, 不能有重复的题目. 但前一次刷新和后一次刷新中, 即不同次刷新的生成中可以有重复的题目出现.


7.请给出实现上面功能excel 的 vba 代码.




== excel 中的 操作

1.按alt + f11 打开 vba

image:/img/0011.png[,]

2.输入vba代码

....
' 标准模块代码
#If VBA7 Then
    Private Declare PtrSafe Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)
#Else
    Private Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)
#End If

Sub GenerateMathProblems()
    Dim ws As Worksheet
    Dim problemSet As Object
    Dim shuffledProblems As Object
    Dim startTime As Double
    Dim i As Long, a As Integer, b As Integer

    startTime = Timer
    Set problemSet = CreateObject("System.Collections.ArrayList")
    Set shuffledProblems = CreateObject("System.Collections.ArrayList")

    ' 清除旧数据
    On Error Resume Next
    Set ws = ThisWorkbook.Sheets("数学题")
    If Err.Number = 0 Then
        With ws.Range("A3:F22")
            .ClearContents
            .Interior.Pattern = xlNone
        End With
    Else
        Set ws = ThisWorkbook.Sheets.Add(After:=ThisWorkbook.Sheets(ThisWorkbook.Sheets.Count))
        ws.Name = "数学题"
    End If
    On Error GoTo 0

    Application.ScreenUpdating = False
    Application.Calculation = xlCalculationManual

    ' 生成题目逻辑（所有数字≥10）
    ' 类型1: a+(     )=c（a≥10, b≥10, c≤100）
    For a = 10 To 90
        For b = 10 To 100 - a
            If a + b <= 100 Then
                problemSet.Add a & "+(     )=" & (a + b)
            End If
        Next b
    Next a

    ' 类型2: c-(     )=a（c≥20, a≥10, b≥10）
    For c = 20 To 100
        For a = 10 To c - 10
            problemSet.Add c & "-(     )=" & a
        Next a
    Next c

    ' 类型3: (     )+a=c（a≥10, b≥10, c≤100）
    For a = 10 To 90
        For c = a + 10 To 100
            problemSet.Add "(     )+" & a & "=" & c
        Next c
    Next a

    ' 类型4: (     )-a=b（a≥10, b≥10, c≤100）
    For a = 10 To 90
        For b = 10 To 100 - a
            problemSet.Add "(     )-" & a & "=" & (a + b)
        Next b
    Next a

    ' 类型5: a+b=(     )（a≥10, b≥10, c≥20）
    For a = 10 To 90
        For b = 10 To 100 - a
            problemSet.Add a & "+" & b & "=(     )"
        Next b
    Next a

    ' 类型6: c-a=(     )（c≥20, a≥10, b≥10）
    For c = 20 To 100
        For a = 10 To c - 10
            problemSet.Add c & "-" & a & "=(     )"
        Next a
    Next c

    ' 去重处理
    problemSet.Sort
    Dim lastItem As String
    For i = problemSet.Count - 1 To 0 Step -1
        If problemSet(i) = lastItem Then
            problemSet.RemoveAt i
        Else
            lastItem = problemSet(i)
        End If
    Next i

    ' 随机打乱顺序
    Randomize
    Do While problemSet.Count > 0
        Dim randIndex As Integer
        randIndex = Int(Rnd * problemSet.Count)
        shuffledProblems.Add problemSet(randIndex)
        problemSet.RemoveAt randIndex
    Loop

    ' 设置表头
    With ws
        ' 第一行标题
        .Range("A1:F1").Merge
        With .Range("A1")
            .Value = "口算测试题 - 100以内的加减法"
            .Font.Size = 18
            .Font.Bold = True
            .HorizontalAlignment = xlCenter
        End With

        ' 第二行信息行
        .Range("A2:F2").Merge
        With .Range("A2")
            .Value = "姓名:________________    年级:________________     班级:________________      完成时间: ________________ "
            .Font.Size = 12
            .HorizontalAlignment = xlLeft
        End With
    End With

    ' 写入题目到第3-22行
    Dim outputArr(1 To 20, 1 To 6) As String
    For i = 0 To 119
        If i < shuffledProblems.Count Then
            outputArr(i \ 6 + 1, (i Mod 6) + 1) = shuffledProblems(i)
        Else
            outputArr(i \ 6 + 1, (i Mod 6) + 1) = "题目不足"
        End If
    Next i
    ws.Range("A3").Resize(20, 6).Value = outputArr

    ' 最终格式验证
    With ws
        ' 强制所有数字≥10的验证
        For Each cell In .Range("A3:F22")
            If InStr(cell.Value, "(     )") > 0 Then
                Dim parts As Variant
                parts = Split(cell.Value, "=")
                ' 验证等号右边的值
                If IsNumeric(parts(1)) Then
                    If Val(parts(1)) < 10 Then cell.Value = "无效题目"
                End If
            End If
        Next cell

        ' 格式设置
        .Columns("A:F").ColumnWidth = 25
        .Rows("3:22").RowHeight = 23
        .Range("A3:F22").Font.Size = 14
        .Range("A3:F22").HorizontalAlignment = xlLeft

        ' 打印设置
        With .PageSetup
            .PrintArea = "$A$1:$F$22"
            .Orientation = xlLandscape
            .Zoom = 85
        End With
    End With

    Application.ScreenUpdating = True
    Application.Calculation = xlCalculationAutomatic

    ' 绑定F9快捷键
    Application.OnKey "{F9}", "GenerateMathProblems"

    Debug.Print "生成耗时：" & Format(Timer - startTime, "0.00") & "秒"
End Sub

' ThisWorkbook代码
Private Sub Workbook_Open()
    Application.OnKey "{F9}", "GenerateMathProblems"
End Sub

....


3.保存文件时选择 ​​.xlsm​​ 格式

4.以后就打开这个 xlsm 文件, 来打印. 注意, 没打印1此后, 就要按 f9可以刷新题目, 再次打印.


image:/img/0012.png[,]
